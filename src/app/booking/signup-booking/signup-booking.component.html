
<main class="calendar calendar-signup" *ngIf="auth.user | async as user">
  <ng-template #loading>
    <app-loading-spinner></app-loading-spinner>
  </ng-template>
  <form class="create-appointment-mobile" [formGroup]="appointmentForm" *ngIf="showStepTwoMobile">
    <div class="close-section">
      <button class="text-link close-btn" (click)="closeMobileAppointment()" type="button">
        <i class="fa__icon fas fa-arrow-left"></i> Back
      </button>
    </div>
    <section class="intro">
      <h1>{{ 'pages.first_consultation.title' | translate }}</h1>
    </section>
    
    <h4>{{ 'pages.booking.signup.dates_times' | translate }}</h4>
    <section class="timeline">
      <div class="start">
        <h5>{{ 'events.from' | translate }}: {{start.startDay}} {{start.startMonth}} {{start.startYear}}</h5>
        <p class="time">
          <i class="fa__icon far fa-clock"></i>
          {{start.startHours}}{{start.startMinutes}}
        </p>
      </div>
      <div class="end">
          <h5>{{ 'events.to' | translate }}: {{end.endDay}} {{end.endMonth}} {{end.endYear}}</h5>
          <p class="time">
            <i class="fa__icon far fa-clock"></i>
            {{end.endHours}}{{end.endMinutes}}
          </p>
      </div>
    </section>

    <div class="meeting-place-picker">
      <h5>{{ 'pages.booking.signup.meet_method' | translate }}</h5>
      <mat-form-field appearance="standard" floatLabel="always">
        <mat-select matInput placeholder="{{ 'pages.booking.form.online_real' | translate }}"
        (selectionChange)="toggleContext()" formControlName="meetMethod" autocomplete="off" 
        panelClass="dropdown-regular" required>
          <mat-option value="faceToFace">{{ 'pages.booking.f2f.title' | translate }}</mat-option>
          <mat-option value="onlineAppointment">{{ 'pages.booking.online.title' | translate }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <ng-container *ngIf="faceToFace | async">
      <div class="location-card">
        <img src="./../../../../assets/img/icons/maps.svg">
        <div class="address">
          <h3>Jirón Arturo García Salazar 306</h3>
          <p>Santiago de Surco. Lima, Perú</p>
        </div>
        <a class="text-link" href="https://goo.gl/maps/uDT69eiTkWytHyfa8" target="_blank">
          <span class="not-mobile">{{ 'pages.booking.buttons.open_in_maps' | translate }}</span>
          <i class="mobile fas fa-external-link-alt"></i>
        </a>
      </div>
    </ng-container>

    <ng-container *ngIf="onlineAppointment | async">
      <div class="meeting-place-picker">
        <mat-form-field appearance="standard" floatLabel="always">
          <mat-select matInput placeholder="{{ 'pages.booking.online.contact_method_placeholder' | translate }}"
          (selectionChange)="toggleContactMethod()" formControlName="contactMethod" autocomplete="off" 
          panelClass="dropdown-regular" required>
            <mat-option value="whatsApp"><i class="fa__icon fab fa-whatsapp"></i>
               {{ 'global.social.whatsapp' | translate }}
            </mat-option>
            <mat-option value="skype"><i class="fa__icon fab fa-skype"></i>
               {{ 'global.social.skype' | translate }}
            </mat-option>
            <mat-option value="phone"><i class="fa__icon fas fa-phone"></i>
               {{ 'pages.booking.signup.only_peru_phone' | translate }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <ng-container *ngIf="whatsApp | async">
        <div class="multiple-input online-phone" *ngIf="areaCodes">
          <mat-form-field appearance="standard" floatLabel="always">
            <mat-label>{{ 'pages.booking.online.code' | translate }}</mat-label>
            <mat-select matInput placeholder="+1"
            panelClass="dropdown-area-code" formControlName="wappAreaCode" autocomplete="off" required>
              <mat-option *ngFor="let code of areaCodes" value="{{code.dial_code}}" class="dial-code">
                <img 
                src="./../../../../assets/img/icons/flags/{{code.name.toString().split(' ').join('-').replace(',', '').split('.').join('').split('(').join('').split(')').join('').toLowerCase() }}.svg">
                <div class="country-content">
                  <span class="country-content__title">{{code.name}}</span>
                  <span class="country-content__code">{{code.dial_code}}</span>
                </div>
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="standard" floatLabel="always">
            <mat-label>{{ 'global.form.phone_number' | translate }}</mat-label>
            <input type="number" formControlName="wappRest" matInput placeholder="123456789" autocomplete="off" >
          </mat-form-field>
        </div>
      </ng-container>

      <ng-container *ngIf="skype | async">
        <mat-form-field appearance="standard" floatLabel="always">
          <mat-label>{{ 'global.social.skype' | translate }}</mat-label>
          <input type="text" matInput formControlName="skypeName"
            placeholder="{{ 'pages.booking.online.skype_name' | translate }}" />
        </mat-form-field>
      </ng-container>

      <ng-container *ngIf="onlinePhone | async">
        <div class="multiple-input">
          <mat-form-field class="fixed-value" appearance="standard" floatLabel="always">
            <mat-label>{{ 'pages.booking.f2f.area_code' | translate }}</mat-label>
            <input type="text" matInput formControlName="phoneAreaCode" [value]="'+51'" readonly
              autofocus="off" autocomplete="off" maxlength="3">
          </mat-form-field>
          <mat-form-field appearance="standard" floatLabel="always">
            <mat-label>{{ 'global.form.phone_number' | translate }}</mat-label>
            <input type="number" formControlName="phoneRest" matInput placeholder="123456789" autocomplete="off" >
          </mat-form-field>
        </div>
      </ng-container>
    </ng-container>

    <button type="submit" class="btn-primary" (click)="addMobileEvent()" [disabled]="!appointmentForm.valid" [class.disabled]="!appointmentForm.valid">
      {{ 'pages.booking.buttons.confirm' | translate }}
    </button>
  </form>

  <section class="action-toolbar-top calendar__toolbar">
    <div class="left">
      <button class="icon-button hidden">
        <i class="fa__icon fas fa-plus"></i>
      </button>
    </div>

    <h1 *ngIf="specialist">
      {{ 'pages.booking.general.calendar' | translate: {name: specialist?.firstName} }}
    </h1>

    <div class="right" *ngIf="specialist">
      <button class="icon-button" (click)="chat(specialist.uid)">
        <i class="fa__icon fas fa-comment-alt"></i>
      </button>
    </div>
  </section>

  <div class="calendar-container">
    <div class="profile-picture" *ngIf="specialist" [style.backgroundImage]="'url('+ specialist.photoURL +')'">
      <span *ngIf="!specialist.photoURL">{{ 'global.errors.no_photo' | translate }}</span>
    </div>

    <section class="calendar__title">
      <button
        class="text-link"
        mwlCalendarPreviousView
        (click)="replaceDates()"
        [view]="view"
        [(viewDate)]="viewDate"
        (viewDateChange)="activeDayIsOpen = false">
        <i class="fa__icon fas fa-arrow-left"></i>
        <span class="not-mobile">{{ 'global.buttons.previous' | translate }}</span>
      </button>
      <h2>
        {{ viewDate | calendarDate:(view + 'ViewTitle'):'en' }}
      </h2>
      <button
        class="text-link"
        mwlCalendarNextView
        (click)="replaceDates()"
        [view]="view"
        [(viewDate)]="viewDate"
        (viewDateChange)="getEvents(user)"
        (viewChange)="getEvents(user)">
      <span class="not-mobile">{{ 'global.buttons.next' | translate }}</span>
        <i class="fa__icon fas fa-arrow-right"></i>
      </button>
    </section>

    <section class="calendar__view" [ngSwitch]="view">
      <div *ngIf="events; else loading">
      <!-- <ng-container *ngIf="appointments"> -->
        <mwl-calendar-month-view
          *ngSwitchCase="CalendarView.Month"
          [viewDate]="viewDate"
          [events]="events"
          [activeDayIsOpen]="activeDayIsOpen"
          (dayClicked)="dayClicked($event.day)"
          [excludeDays]="excludeDays">
        </mwl-calendar-month-view>
        <mwl-calendar-week-view
          *ngSwitchCase="CalendarView.Week"
          [viewDate]="viewDate"
          (hourSegmentClicked)="hourClicked($event.date)"
          [dayStartHour]="16"
          [dayEndHour]="20"
          [events]="events"
          [excludeDays]="excludeDays">
        </mwl-calendar-week-view>
        <mwl-calendar-day-view
          *ngSwitchCase="CalendarView.Day"
          [viewDate]="viewDate"
          (hourSegmentClicked)="hourClicked($event.date)"
          [dayStartHour]="16"
          [dayEndHour]="20"
          [events]="events">
        </mwl-calendar-day-view>
      </div>
    </section>
  </div>
</main>



