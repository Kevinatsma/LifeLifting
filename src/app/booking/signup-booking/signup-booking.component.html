
<main class="calendar calendar-signup" *ngIf="auth.user | async as user">
  <ng-template #loading>
    <app-loading-spinner></app-loading-spinner>
  </ng-template>
  <form class="create-appointment-mobile" [formGroup]="appointmentForm" *ngIf="showStepTwoMobile">
    <div class="close-section">
      <button class="text-link close-btn" (click)="closeMobileAppointment()" type="button">
        <i class="fa__icon fas fa-arrow-left"></i> Back
      </button>
    </div>
    <section class="intro">
      <h1>First consultation</h1>
    </section>
    
    <h4>Dates & times</h4>
    <section class="timeline">
      <div class="start">
        <h5>From: {{start.startDay}} {{start.startMonth}} {{start.startYear}}</h5>
        <p class="time">
          <i class="fa__icon far fa-clock"></i>
          {{start.startHours}}{{start.startMinutes}}
        </p>
      </div>
      <div class="end">
          <h5>To: {{end.endDay}} {{end.endMonth}} {{end.endYear}}</h5>
          <p class="time">
            <i class="fa__icon far fa-clock"></i>
            {{end.endHours}}{{end.endMinutes}}
          </p>
      </div>
    </section>

    <div class="meeting-place-picker">
      <h5>How is the meeting taking place?</h5>
      <mat-form-field appearance="standard" floatLabel="always">
        <mat-select matInput placeholder="Online or in real?"
        (selectionChange)="toggleContext()" formControlName="meetMethod" autocomplete="off" 
        panelClass="dropdown-regular" required>
          <mat-option value="faceToFace">Face to face</mat-option>
          <mat-option value="onlineAppointment">Online appointment</mat-option>
        </mat-select>
        <!-- <mat-error class="input-error" *ngIf="!callMethod.valid && onlineAppointmentForm.touched">This is <strong>required</strong></mat-error> -->
      </mat-form-field>
    </div>

    <ng-container *ngIf="faceToFace | async">
      <div class="location-card">
        <img src="./../../../../assets/img/icons/maps.svg">
        <div class="address">
          <h3>Jirón Arturo García Salazar 306</h3>
          <p>Chama - Surco. Lima, Perú</p>
        </div>
        <a class="text-link" href="https://goo.gl/maps/3dXhLj2B94KLRWZS8" target="_blank">
          <span class="not-mobile">Open in Maps</span>
          <i class="mobile fas fa-external-link-alt"></i>
        </a>
      </div>
    </ng-container>

    <ng-container *ngIf="onlineAppointment | async">
      <div class="meeting-place-picker">
        <mat-form-field appearance="standard" floatLabel="always">
          <mat-select matInput placeholder="How would you like to be contacted?"
          (selectionChange)="toggleContactMethod()" formControlName="contactMethod" autocomplete="off" 
          panelClass="dropdown-regular" required>
            <mat-option value="whatsApp"><i class="fa__icon fab fa-whatsapp"></i> WhatsApp</mat-option>
            <mat-option value="skype"><i class="fa__icon fab fa-skype"></i> Skype</mat-option>
            <mat-option value="phone"><i class="fa__icon fas fa-phone"></i> Phone (only Peru)</mat-option>
          </mat-select>
          <!-- <mat-error class="input-error" *ngIf="!callMethod.valid && onlineAppointmentForm.touched">This is <strong>required</strong></mat-error> -->
        </mat-form-field>
      </div>

      <ng-container *ngIf="whatsApp | async">
        <div class="multiple-input online-phone" *ngIf="areaCodes">
          <mat-form-field appearance="standard" floatLabel="always">
            <mat-label>Code</mat-label>
            <mat-select matInput placeholder="+1"
            panelClass="dropdown-area-code" formControlName="wappAreaCode" autocomplete="off" required>
              <mat-option *ngFor="let code of areaCodes" value="{{code.dial_code}}" class="dial-code">
                <img 
                src="./../../../../assets/img/icons/flags/{{code.name.toString().split(' ').join('-').replace(',', '').split('.').join('').split('(').join('').split(')').join('').toLowerCase() }}.svg">
                <div class="country-content">
                  <span class="country-content__title">{{code.name}}</span>
                  <span class="country-content__code">{{code.dial_code}}</span>
                </div>
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="standard" floatLabel="always">
            <mat-label>Phone Number</mat-label>
            <input type="number" formControlName="wappRest" matInput placeholder="123456789" autocomplete="off" >
          </mat-form-field>
        </div>
      </ng-container>

      <ng-container *ngIf="skype | async">
        <mat-form-field appearance="standard" floatLabel="always">
          <mat-label>Skype name</mat-label>
          <input type="text" matInput formControlName="skypeName" placeholder="What's your skype name?" />
        </mat-form-field>
      </ng-container>

      <ng-container *ngIf="onlinePhone | async">
        <div class="multiple-input">
          <mat-form-field class="fixed-value" appearance="standard" floatLabel="always">
            <mat-label>Area code</mat-label>
            <input type="text" matInput formControlName="phoneAreaCode" [value]="'+51'" readonly
              autofocus="off" autocomplete="off" maxlength="3">
          </mat-form-field>
          <mat-form-field appearance="standard" floatLabel="always">
            <mat-label>Phone Number</mat-label>
            <input type="number" formControlName="phoneRest" matInput placeholder="123456789" autocomplete="off" >
          </mat-form-field>
        </div>
      </ng-container>
    </ng-container>

    <button type="submit" class="btn-primary" (click)="addMobileEvent()" [disabled]="!appointmentForm.valid" [class.disabled]="!appointmentForm.valid">
      Confirm appointment
    </button>
  </form>

  <section class="action-toolbar-top calendar__toolbar">
    <div class="left">
      <button class="icon-button hidden">
        <i class="fa__icon fas fa-plus"></i>
      </button>
    </div>

    <h1 *ngIf="specialist">{{specialist.firstName}}'s Calendar</h1>

    <div class="right" *ngIf="specialist">
      <button class="icon-button" (click)="chat(specialist.uid)" matTooltip="User hasn't completed the Signup process yet"
      matTooltipClass="tooltip-info" [matTooltipPosition]="below">
        <i class="fa__icon fas fa-comment-alt"></i>
      </button>
    </div>
  </section>

  <div class="calendar-container">
    <div class="profile-picture" *ngIf="specialist" [style.backgroundImage]="'url('+ specialist.photoURL +')'">
      <span *ngIf="!specialist.photoURL">No Photo Yet</span>
    </div>

    <section class="calendar__title">
      <button
        class="text-link"
        mwlCalendarPreviousView
        (click)="replaceDates()"
        [view]="view"
        [(viewDate)]="viewDate"
        (viewDateChange)="activeDayIsOpen = false"
      >
        <i class="fa__icon fas fa-arrow-left"></i>
        <span class="not-mobile">Previous</span>
      </button>
      <h2>
        {{ viewDate | calendarDate:(view + 'ViewTitle'):'en' }}
      </h2>
      <button
        class="text-link"
        mwlCalendarNextView
        (click)="replaceDates()"
        [view]="view"
        [(viewDate)]="viewDate"
        (viewDateChange)="getEvents(user)"
        (viewChange)="getEvents(user)"
      >
      <span class="not-mobile">Next</span>
        <i class="fa__icon fas fa-arrow-right"></i>
      </button>
    </section>

    <section class="calendar__view" [ngSwitch]="view">
      <div *ngIf="events$ | async; else loading; let events">
      <!-- <ng-container *ngIf="appointments"> -->
        <mwl-calendar-month-view
          *ngSwitchCase="CalendarView.Month"
          [viewDate]="viewDate"
          [events]="events"
          [activeDayIsOpen]="activeDayIsOpen"
          (dayClicked)="dayClicked($event.day)"
        >
        </mwl-calendar-month-view>
        <mwl-calendar-week-view
          *ngSwitchCase="CalendarView.Week"
          [viewDate]="viewDate"
          (hourSegmentClicked)="hourClicked($event.date)"
          [dayStartHour]="16"
          [dayEndHour]="21"
          [events]="events"
        >
        </mwl-calendar-week-view>
        <mwl-calendar-day-view
          *ngSwitchCase="CalendarView.Day"
          [viewDate]="viewDate"
          (hourSegmentClicked)="hourClicked($event.date)"
          [dayStartHour]="16"
          [dayEndHour]="21"
          [events]="events"
        >
        </mwl-calendar-day-view>
      </div>
    </section>
  </div>
</main>



