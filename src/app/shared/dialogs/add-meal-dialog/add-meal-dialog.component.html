<main class="dialog-wrapper">
  <mat-horizontal-stepper #stepper>
    <mat-step [stepControl]="infoForm">
      <form [formGroup]="infoForm">
        <ng-template matStepLabel>Info</ng-template>
        <h3>‚è≤Ô∏è Mealplan Info for {{userData.displayName}}</h3>
        <p class="card-text">
          The mealplan for the client. This mealplan has to be filled out on the first meeting with the client(!).
          This document is of huge importance, since we can calculate heaps of things based on the values you'll enter
          here. Be precise and ask thouroughly to be as personal as possible for you client.
        </p>
    
        <mat-form-field appearance="standard" floatLabel="always">
          <mat-label>Mealplan ID</mat-label>
          <input type="number" matInput name="mealplanID" formControlName="mealplanID" placeholder="Always a number" autocomplete="new-password">
          <mat-hint *ngIf="!infoForm['controls'].mealplanID.dirty">Check the mealplan list for the numbers already taken.</mat-hint>
          <mat-error class="input-error" *ngIf="!infoForm['controls'].mealplanID.valid">This is <strong>required</strong></mat-error>
        </mat-form-field>
    
        <mat-form-field appearance="standard" floatLabel="always">
          <mat-label>Mealplan name</mat-label>
          <input type="text" matInput name="mealplanName" formControlName="mealplanName" placeholder="Give the mealplan a name" autofocus="none">
          <mat-error class="input-error" *ngIf="!infoForm['controls'].mealplanName.valid">This is <strong>required</strong></mat-error>
        </mat-form-field>
      </form>

      <section class="btn-area-one">
        <button type="button" class="dialog-button" matStepperNext>Next</button>
      </section>
    </mat-step>

    <mat-step [stepControl]="mealTimeForm">
      <form [formGroup]="mealTimeForm">
        <ng-template matStepLabel>Meal times</ng-template>
        <h3>üèÇ Meal Times for {{userData.displayName}}</h3>
        <p class="intro-text">
          Define the meal times for this client. You will have to fill out meals for all the meal times you enter. 
        </p>

        <div class="add-form-field-container" formArrayName="mealTimeArr">
          <h4>Add the Meal Times</h4>
          <section class="dynamic-form-field-container mealtimes" *ngFor="let mealTime of mealTimeForms.controls; let i=index" [formGroupName]="i">
            <div class="number-id">
              <h1>{{i+1}}</h1>
            </div>
            <div class="form-fields">
              <mat-form-field appearance="standard" floatLabel="always">
                <mat-label>Which meal times suit the client best?</mat-label>
                <mat-select matInput placeholder="Pick a Meal Time" formControlName="mealTime" 
                panelClass="dropdown-regular" autocomplete="off" (selectionChange)="updateMealTimes()" required>
                  <mat-option *ngFor="let time of times" [value]="time.value"> {{time.value}}</mat-option>
                </mat-select>
                <!-- <mat-error class="input-error" *ngIf="!mealTimeID.touched">This is <strong>required</strong></mat-error> -->
              </mat-form-field>
            </div>
            <div class="btn-area">
              <button type="button"mat-icon-button type="button" class="delete-btn" (click)="deleteMealTime(i); checkMealTime();">
                <i class="fa fa-trash"></i>
              </button>
            </div>
          </section>
        </div>


        <button type="button" *ngIf="showAddMealTime" class="add-form-field" (click)="addMealTime(); checkMealTime();">
          <i class="fa fa-plus"></i>
          Add a Meal Time
        </button>
      </form>

      <section class="btn-area">
        <button type="button" class="dialog-button" matStepperPrevious>Back</button>
        <button type="button" class="dialog-button" matStepperNext>Next</button>
      </section>
    </mat-step>

    <mat-step [stepControl]="mondayForm">
    <ng-template matStepLabel>Monday</ng-template>
      <ng-container *ngIf="!mealTimeForms.dirty">
        <h5>ü§¶ Fill out some mealtimes to see something here</h5>
      </ng-container>
      <app-monday-form *ngIf="mealTimeForms.dirty" [foods]="foods" [mealTimes]="mealTimeArr">
      </app-monday-form>

      <section class="btn-area">
        <button type="button" class="dialog-button" matStepperPrevious>Back</button>
        <button type="button" class="dialog-button" matStepperNext>Next</button>
      </section>

    </mat-step>

    <mat-step [stepControl]="tuesdayForm">

      <section class="btn-area">
        <button type="button" class="dialog-button" matStepperPrevious>Back</button>
        <button type="button" class="dialog-button" matStepperNext>Next</button>
      </section>

    </mat-step>

    <mat-step [stepControl]="wednesdayForm">

      <section class="btn-area">
        <button type="button" class="dialog-button" matStepperPrevious>Back</button>
        <button type="button" class="dialog-button" matStepperNext>Next</button>
      </section>

    </mat-step>

    <mat-step [stepControl]="thursdayForm">

      <section class="btn-area">
        <button type="button" class="dialog-button" matStepperPrevious>Back</button>
        <button type="button" class="dialog-button" matStepperNext>Next</button>
      </section>

    </mat-step>

    <mat-step [stepControl]="fridayForm">

      <section class="btn-area">
        <button type="button" class="dialog-button" matStepperPrevious>Back</button>
        <button type="button" class="dialog-button" matStepperNext>Next</button>
      </section>

    </mat-step>

    <mat-step [stepControl]="suppForm">
      <form [formGroup]="suppForm">
        <ng-template matStepLabel>Supps</ng-template>
        <h3>ü•ú Supplements for {{userData.displayName}}</h3>
        <p class="intro-text">
          Define the supplements the user should take before, during and/or after the training. All values are optional.
        </p>

        <mat-form-field appearance="standard" floatLabel="always">
          <mat-label>Before the training</mat-label>
          <input type="text" matInput name="before" formControlName="before" 
          placeholder="Which supplements?" autofocus="off" autocomplete="off">
          <mat-error class="input-error" *ngIf="!suppForm['controls'].before.valid && suppForm.touched">
            This is <strong>required</strong>
          </mat-error>
        </mat-form-field>
        <mat-form-field appearance="standard" floatLabel="always">
          <mat-label>During the training</mat-label>
          <input type="text" matInput name="during" formControlName="during" 
          placeholder="Which supplements?" autofocus="off" autocomplete="off">
          <mat-error class="input-error" *ngIf="!suppForm['controls'].during.valid && suppForm.touched">
            This is <strong>required</strong>
          </mat-error>
        </mat-form-field>
        <mat-form-field appearance="standard" floatLabel="always">
          <mat-label>After the training</mat-label>
          <input type="text" matInput name="after" formControlName="after" 
          placeholder="Which supplements?" autofocus="off" autocomplete="off">
          <mat-error class="input-error" *ngIf="!suppForm['controls'].after.valid && suppForm.touched">
            This is <strong>required</strong>
          </mat-error>
        </mat-form-field>
      </form>

      <section class="btn-area">
        <button type="button" class="dialog-button" matStepperPrevious>Back</button>
        <button type="submit" class="dialog-button" (click)="addMealplan()"
          [disabled]="!infoForm.valid || !mealTimeForm.valid || !mondayForm.valid || 
                      !tuesdayForm.valid || !wednesdayForm.valid || !thursdayForm.valid ||
                      !fridayForm.valid || !suppForm.valid"
          [class.disabled]="!infoForm.valid || !mealTimeForm.valid || !mondayForm.valid || 
                            !tuesdayForm.valid || !wednesdayForm.valid || !thursdayForm.valid || 
                            !fridayForm.valid || !suppForm.valid"
          mat-dialog-close
        >
          Done
        </button>
      </section>

    </mat-step>

  </mat-horizontal-stepper>
</main>
